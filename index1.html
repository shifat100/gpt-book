<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Complete Flipbook Library</title>

    <!-- ‡ßß. ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü (‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®) -->
    <!-- jQuery (Turn.js ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Turn.js (‡¶´‡ßç‡¶≤‡¶ø‡¶™ ‡¶è‡¶´‡ßá‡¶ï‡ßç‡¶ü) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
    
    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- ‡¶´‡¶®‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶á‡¶ï‡¶® -->
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- ‡ß®. CSS ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ -->
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; padding: 0; width: 100%; height: 100vh; 
            font-family: 'Crimson Text', serif; overflow: hidden; 
            background-color: #333; /* ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° */
            transition: background 0.3s;
        }

        /* ‡¶•‡¶ø‡¶Æ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞‡¶∏ */
        body.theme-white { background-color: #f0f0f0; --paper: #fff; --text: #333; }
        body.theme-sepia { background-color: #5b4636; --paper: #fdf6e3; --text: #5b4636; }
        body.theme-black { background-color: #222; --paper: #1a1a1a; --text: #ccc; }

        /* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
        .app-container { width: 100%; height: 100%; display: flex; flex-direction: column; }

        /* ‡¶π‡ßã‡¶Æ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® */
        .home-view { 
            width: 100%; height: 100%; overflow-y: auto; 
            background: #eaddcf; padding: 40px 20px; text-align: center; 
        }
        .book-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 30px; max-width: 1000px; margin: 0 auto; 
        }
        .book-card {
            background: #4a192c; color: #d4af37; border-radius: 5px; cursor: pointer;
            height: 280px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3); border-left: 10px solid #2c0e1a;
            transition: transform 0.3s;
        }
        .book-card:hover { transform: translateY(-10px); }

        /* ‡¶∞‡¶ø‡¶°‡¶æ‡¶∞ ‡¶è‡¶∞‡¶ø‡ßü‡¶æ (‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶´‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßÅ‡¶ï ‡¶•‡¶æ‡¶ï‡¶¨‡ßá) */
        .reader-area { 
            flex: 1; display: flex; justify-content: center; align-items: center; 
            position: relative; overflow: hidden;
        }

        /* ‡¶´‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßÅ‡¶ï ‡¶™‡ßá‡¶ú ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        #flipbook { transition: margin 0.3s; }
        
        .page {
            background-color: var(--paper, #fff); color: var(--text, #333);
            box-shadow: inset -5px 0 20px rgba(0,0,0,0.05);
            font-size: 18px; line-height: 1.6; text-align: justify;
            overflow: hidden; border: 1px solid rgba(0,0,0,0.1);
        }
        
        .page-content { 
            padding: 40px; height: 100%; display: flex; flex-direction: column; 
        }
        
        /* ‡¶ï‡¶≠‡¶æ‡¶∞ ‡¶™‡ßá‡¶ú */
        .page.hard {
            background: #4a192c !important; color: #d4af37 !important;
            border: 5px double #d4af37;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }

        /* ‡¶á‡¶Æ‡ßá‡¶ú ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .page-content img { max-width: 100%; max-height: 80%; display: block; margin: 10px auto; }
        
        /* ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶¨‡¶æ‡¶∞ */
        .controls {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #fff; padding: 10px 20px; border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3); display: flex; gap: 15px; z-index: 1000;
            align-items: center;
        }
        .btn { 
            background: none; border: none; cursor: pointer; color: #333; 
            display: flex; align-items: center; justify-content: center; 
            padding: 8px; border-radius: 50%; transition: 0.2s; 
        }
        .btn:hover { background: rgba(0,0,0,0.1); }
        .divider { width: 1px; height: 20px; background: #ccc; }

        /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏‡¶ø‡¶≠ */
        @media (max-width: 768px) {
            .page-content { padding: 20px; font-size: 16px; }
            .controls { padding: 8px 15px; width: 90%; justify-content: space-between; gap: 5px; }
        }

        /* ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ */
        .loader { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); color: white; display: flex; 
            flex-direction: column; justify-content: center; align-items: center; 
            z-index: 3000; font-family: sans-serif;
        }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #d4af37;
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="root"></div>

    <!-- ‡ß©. ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü (React ‡¶ï‡ßã‡¶°) -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ‡¶ï‡¶Æ‡ßç‡¶™‡ßã‡¶®‡ßá‡¶®‡ßç‡¶ü: ‡¶´‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßÅ‡¶ï ‡¶∞‡¶ø‡¶°‡¶æ‡¶∞ ---
        const FlipbookReader = ({ content, title, fontSize, theme }) => {
            const flipbookRef = useRef(null);
            const [pages, setPages] = useState([]);
            const [ready, setReady] = useState(false);

            // ‡ßß. HTML ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü‡¶ï‡ßá ‡¶™‡ßá‡¶ú‡ßá ‡¶≠‡¶æ‡¶ó ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
            useEffect(() => {
                if (!content) return;

                const parser = new DOMParser();
                // Markdown ‡¶•‡ßá‡¶ï‡ßá HTML ‡¶è ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞
                const htmlString = marked.parse(content);
                const doc = parser.parseFromString(htmlString, 'text/html');
                const elements = Array.from(doc.body.children);

                let newPages = [];
                let currentPage = "";
                
                // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ï‡ßç‡¶ü‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü (‡¶™‡ßá‡¶ú ‡¶ï‡¶§ ‡¶¨‡ßú ‡¶π‡¶¨‡ßá)
                const isMobile = window.innerWidth < 768;
                const charLimit = isMobile ? 550 : 950; 
                let currentCount = 0;

                elements.forEach(el => {
                    const elHTML = el.outerHTML;
                    const textLen = el.textContent.length;
                    
                    // h1, h2 ‡¶™‡ßá‡¶≤‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶§‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá (‡¶ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡ßá‡¶ï)
                    const isHeader = el.tagName === 'H1' || el.tagName === 'H2';
                    // ‡¶á‡¶Æ‡ßá‡¶ú ‡¶™‡ßá‡¶≤‡ßá ‡¶¨‡¶æ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶ï‡ßç‡¶∞‡¶∏ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶§‡¶æ
                    const isImage = el.tagName === 'IMG';

                    if ((currentPage && isHeader) || (currentCount + textLen > charLimit) || isImage) {
                        if (currentPage) newPages.push(currentPage);
                        currentPage = "";
                        currentCount = 0;
                    }
                    
                    currentPage += elHTML;
                    currentCount += textLen;
                    
                    // ‡¶á‡¶Æ‡ßá‡¶ú ‡¶è‡¶ï‡¶æ ‡¶è‡¶ï ‡¶™‡ßá‡¶ú‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
                    if(isImage && currentPage) {
                        newPages.push(currentPage);
                        currentPage = "";
                        currentCount = 0;
                    }
                });
                
                if (currentPage) newPages.push(currentPage);
                
                // ‡¶™‡ßá‡¶ú ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá ‡¶§‡ßà‡¶∞‡¶ø
                setPages([
                    { type: 'cover', content: title },
                    ...newPages.map(c => ({ type: 'content', content: c })),
                    { type: 'end', content: '‡¶∏‡¶Æ‡¶æ‡¶™‡ßç‡¶§' }
                ]);
                setReady(false); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶∏‡¶≤‡ßá ‡¶∞‡¶ø-‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá
            }, [content, title]);

            // ‡ß®. Turn.js ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®
            useEffect(() => {
                if (pages.length === 0 || !flipbookRef.current) return;

                const $el = $(flipbookRef.current);
                
                // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶¨‡¶á ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
                try { if ($el.data().turn) $el.turn('destroy'); } catch(e){}

                // ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶∏‡¶æ‡¶á‡¶ú ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶¨‡¶á‡ßü‡ßá‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú
                const w = window.innerWidth;
                const h = window.innerHeight;
                const isMobile = w < 768;
                
                let bookH = h * 0.85; // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá‡¶∞ ‡ßÆ‡ß´% ‡¶â‡¶ö‡ßç‡¶ö‡¶§‡¶æ
                let bookW = isMobile ? (w * 0.94) : (bookH * 1.4);
                if (!isMobile && bookW > w * 0.9) bookW = w * 0.9;

                // DOM ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ Turn.js ‡¶ö‡¶æ‡¶≤‡ßÅ
                setTimeout(() => {
                    $el.turn({
                        width: bookW,
                        height: bookH,
                        autoCenter: true,
                        display: isMobile ? 'single' : 'double', // ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá ‡ßß ‡¶™‡¶æ‡¶§‡¶æ, ‡¶™‡¶ø‡¶∏‡¶ø‡¶§‡ßá ‡ß® ‡¶™‡¶æ‡¶§‡¶æ
                        duration: 1000,
                        gradients: true,
                        elevation: 50,
                        acceleration: true
                    });

                    // ‡¶ï‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü
                    $(window).unbind('keydown').bind('keydown', function(e) {
                        if (e.keyCode == 37) $el.turn('previous');
                        if (e.keyCode == 39) $el.turn('next');
                    });

                    setReady(true);
                }, 100);

                return () => { try { if ($el.data().turn) $el.turn('destroy'); } catch(e){} };
            }, [pages]);

            // ‡ß©. ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            useEffect(() => {
                if(flipbookRef.current) {
                    const divs = flipbookRef.current.querySelectorAll('.page-content');
                    divs.forEach(div => div.style.fontSize = `${fontSize}px`);
                }
            }, [fontSize]);

            // ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ HTML
            return (
                <div id="flipbook" ref={flipbookRef} style={{opacity: ready ? 1 : 0}}>
                    {pages.map((page, idx) => {
                        if (page.type === 'cover') {
                            return (
                                <div key={idx} className="page hard">
                                    <div style={{border:'3px double #d4af37', width:'90%', height:'90%', display:'flex', flexDirection:'column', justifyContent:'center', alignItems:'center'}}>
                                        <h1 style={{fontSize:'2.5rem', margin:0}}>{page.content}</h1>
                                        <p style={{marginTop:'20px'}}>‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡¶á</p>
                                    </div>
                                </div>
                            );
                        } else if (page.type === 'end') {
                            return <div key={idx} className="page hard"><h3>{page.content}</h3></div>;
                        } else {
                            return (
                                <div key={idx} className="page">
                                    <div className="page-content" style={{fontSize: `${fontSize}px`}} dangerouslySetInnerHTML={{__html: page.content}}></div>
                                    <div style={{position:'absolute', bottom:'10px', right:'20px', fontSize:'12px', opacity:0.5}}>{idx}</div>
                                </div>
                            );
                        }
                    })}
                </div>
            );
        };

        // --- ‡¶Æ‡ßÇ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶Æ‡ßç‡¶™‡ßã‡¶®‡ßá‡¶®‡ßç‡¶ü ---
        function App() {
            const [books, setBooks] = useState([]);
            const [activeBook, setActiveBook] = useState(null);
            const [fullBookContent, setFullBookContent] = useState('');
            const [viewMode, setViewMode] = useState('home'); 
            const [theme, setTheme] = useState('white'); 
            const [fontSize, setFontSize] = useState(18);
            const [loading, setLoading] = useState(false);

            // ‡ßß. ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶≤‡ßã‡¶°
            useEffect(() => {
                fetch('books/db.json')
                    .then(res => res.json())
                    .then(data => setBooks(data))
                    .catch(() => {
                        console.log("db.json not found, loading dummy data");
                        // ‡¶°‡¶æ‡¶Æ‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ (‡¶Ø‡¶¶‡¶ø json ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá)
                        setBooks([
                            { 
                                id: "1", title: "Test Book (All Chapters)", 
                                folder: "books/demo",
                                chapters: [
                                    {file: "0.md", title: "‡¶≠‡ßÇ‡¶Æ‡¶ø‡¶ï‡¶æ"},
                                    {file: "1.md", title: "‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü"},
                                    {file: "2.md", title: "‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü"}
                                ] 
                            },
                            { id: "2", title: "Simple Story", chapters: [{file: "story.md", title: "The Story"}] }
                        ]);
                    });
            }, []);

            // ‡¶•‡¶ø‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶≤‡ßá ‡¶¨‡¶°‡¶ø ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            useEffect(() => { document.body.className = `theme-${theme}`; }, [theme]);

            // ‡ß®. ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡¶á ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶∏‡¶¨ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶ü‡¶æ‡¶∞ ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá)
            const loadFullBook = async (book) => {
                setLoading(true);
                setActiveBook(book);
                
                try {
                    // ‡¶∏‡¶¨ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶´‡ßá‡¶ö ‡¶ï‡¶∞‡¶æ
                    const promises = book.chapters.map(chapter => {
                        const path = book.folder ? `${book.folder}/${chapter.file}` : chapter.file;
                        return fetch(path)
                            .then(res => {
                                if (!res.ok) throw new Error("File not found");
                                return res.text();
                            })
                            // ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
                            .then(text => `# ${chapter.title}\n\n${text}`)
                            .catch(err => `# ${chapter.title}\n\n(‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø: ${chapter.file})`);
                    });

                    // ‡¶∏‡¶¨ ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ
                    const texts = await Promise.all(promises);
                    
                    // ‡¶∏‡¶¨ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ú‡ßã‡ßú‡¶æ ‡¶≤‡¶æ‡¶ó‡¶æ‡¶®‡ßã
                    const combined = texts.join('\n\n<hr/>\n\n'); 
                    
                    setFullBookContent(combined);
                    setViewMode('read');
                } catch (error) {
                    console.error("Error loading book:", error);
                    alert("‡¶¨‡¶á ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
                }
                setLoading(false);
            };

            const goHome = () => {
                setViewMode('home');
                setFullBookContent('');
                // ‡¶Æ‡ßá‡¶Æ‡ßã‡¶∞‡¶ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™
                if ($('#flipbook').turn('is')) $('#flipbook').turn('destroy');
            };

            const cycleTheme = () => setTheme(t => t==='white'?'sepia':t==='sepia'?'black':'white');

            return (
                <div className="app-container">
                    {loading && <div className="loader"><div className="spinner"></div>‡¶¨‡¶á ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>}

                    {/* ‡¶π‡ßã‡¶Æ ‡¶≠‡¶ø‡¶â */}
                    {viewMode === 'home' && (
                        <div className="home-view">
                            <div style={{fontSize:'2.5rem', color:'#4a192c', fontWeight:'bold', marginBottom:'30px'}}>MY LIBRARY</div>
                            <div className="book-grid">
                                {books.map(b => (
                                    <div key={b.id} className="book-card" onClick={() => loadFullBook(b)}>
                                        <div style={{fontSize:'1.5rem', fontWeight:'bold', marginBottom:'10px', textAlign:'center'}}>{b.title}</div>
                                        <div style={{opacity:0.8}}>{b.chapters.length} Chapters</div>
                                        <div style={{marginTop:'auto', fontSize:'2rem'}}>üìñ</div>
                                        <div style={{fontSize:'12px', marginTop:'5px'}}>Tap to Read</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* ‡¶∞‡¶ø‡¶°‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶â */}
                    {viewMode === 'read' && (
                        <div className="reader-area">
                            <FlipbookReader 
                                content={fullBookContent} 
                                title={activeBook.title}
                                fontSize={fontSize}
                                theme={theme}
                            />
                            
                            {/* ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶¨‡¶æ‡¶ü‡¶®‡¶∏ */}
                            <div className="controls">
                                <button className="btn" onClick={goHome} title="Library"><span className="material-icons">home</span></button>
                                <div className="divider"></div>
                                
                                <button className="btn" onClick={() => $('#flipbook').turn('previous')}><span className="material-icons">west</span></button>
                                <button className="btn" onClick={() => $('#flipbook').turn('next')}><span className="material-icons">east</span></button>
                                
                                <div className="divider"></div>
                                <button className="btn" onClick={() => setFontSize(s => Math.max(14, s-2))}>A-</button>
                                <button className="btn" onClick={() => setFontSize(s => Math.min(32, s+2))}>A+</button>
                                <div className="divider"></div>
                                <button className="btn" onClick={cycleTheme}><span className="material-icons">brightness_6</span></button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
